<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>全新九合一预防方案</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="./layui/css/layui.css" />
    <link rel="stylesheet" href="./css/media.css">
    <link rel="stylesheet" href="./css/rolldate.css">
    <script src="./js/jquery.min.js"></script>
    <script src="./layui/layui.js"></script>
    <script src="./js/rolldate.min.js"></script>
    <script src="https://res.wx.qq.com/open/js/jweixin-1.3.2.js"></script>
</head>
<style>
    .layui-tab-bar{
        display: none;
    }
    .introduce-common{
        padding: 10px 0;
        border-bottom: 1px solid #E4E7ED;
        color: rgb(138,138,138);
    }
</style>
<body>
    <div class="back-mini" style="display: none;">
        正在返回小程序...
    </div>
    <div style="margin-bottom: .8rem;">
        <div style="width: 95%;margin: 0 auto;font-size: 15px;">
            <div style="font-size: 18px;font-weight: bold;padding: 10px 0;border-bottom: 1px solid #E4E7ED;">加卫苗9合一 HPV9子宫颈癌疫苗</div>
            <div class="introduce-common">微信优惠价(港币现金) : <span style="color: rgb(237,61,20);font-size: 18px;">8,250.00</span></div>
            <div class="introduce-common">原价港币: <s>9,380.00</s></div>
            <div class="introduce-common">预约服务费: 50元</div>
            <div class="introduce-common">可最快6个月内完成3针或根据厂房指引1年内完成</div>
        </div>
        <!--<img style="width: 100%;" src="https://51bx.club/img/info.jpg" alt="全新九合一预防方案">-->

        <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
            <ul class="layui-tab-title">
                <li class="layui-this">产品详情</li>
                <li>注意事项</li>
                <li>常见问题</li>
                <li>公司介绍</li>
            </ul>
            <div class="layui-tab-content" style="padding: 0;">
                <div class="layui-tab-item layui-show">
                    <img style="width: 100%;" src="https://51bx.club/img/ad-banner.jpg" alt="全新九合一预防方案">
                </div>
                <div class="layui-tab-item">2</div>
                <div class="layui-tab-item">3</div>
                <div class="layui-tab-item">4</div>
            </div>
            </div>
        </div>
    </div>

    <div class="back-wall"></div>
    <div class="more-back-wall"></div>

    <div class="btn-control">
        <button class="btn book-btn">马上预约</button>
    </div>

    <div class="form-control">
        <div class="form-item" style="padding-top: 15px;">
            <div class="label">
                名字
            </div>
            <div class="control">
                <input type="text" id="name" placeholder="请输入名字">
            </div>
        </div>
        <div class="form-item">
            <div class="label">
                拼音
            </div>
            <div class="control">
                <input type="text" id="pinyin" placeholder="请输入拼音">
            </div>
        </div>

        <div class="form-item">
            <div class="label">
                电话号码
            </div>
            <div class="control">
                <input type="text" id="phone" placeholder="请输入电话号码">
            </div>
        </div>

        <div class="form-item">
            <div class="label">
                邮箱
            </div>
            <div class="control">
                <input type="text" id="email" placeholder="请输入邮箱">
            </div>
        </div>

        <div class="form-item">
            <div class="label">
                预约日期
            </div>
            <div class="control">
                <input readonly type="text" id="date" placeholder="请选择预约日期">
            </div>
        </div>

        <div class="form-item">
            <div class="label">
                微信号
            </div>
            <div class="control">
                <input type="text" id="wx_number" placeholder="请输入微信号">
            </div>
        </div>

        <div class="form-item">
            <button class="btn book-btn submit-btn" style="height: .5rem;width: 200px;margin-bottom: .1rem;">提交</button>
        </div>
    </div>
</body>
<script>
    $(function(){
        layui.use('element', function(){
            var element = layui.element;

            //…
        });
        new rolldate.Date({
            el:'#date',
            format:'YYYY-MM-DD',
            beginYear:2018,
            endYear:2100,
            theme:'blue',
            confirmBefore:function(el , date){
                let bookDate = new Date(date).getTime();
                let current = new Date().getTime();

                if(current > bookDate){
                    layui.use('layer', function(){
                        // var layer = layui.layer;
                        // layer.msg('请输入您的名字');

                        layer.ready(function(){
                            layer.msg('请选择正确的时间', {icon:2});
                        });
                    });
                    return false;
                }
            },
            tapBefore:function(el){
                // if(1 == 1){
                //     //console.log(this);
                //     console.log('阻止插件继续执行');
                //     return false;
                // }
            }
        })

        $(".book-btn").on('click' , function(){
            $('.back-wall').show();
            $('.form-control').show();
            // wx.miniProgram.postMessage({ target: 'customer' });
            // let redirectUrl = '/pages/index?target=customer';
            // wx.miniProgram.redirectTo({url: redirectUrl})
        })

        $('.back-wall').on('click' , function(){
            $('.back-wall').hide();
            $('.form-control').hide();
        })

        //马上预约按钮
        $('.submit-btn').on('click' , function(){
            let name = $('#name').val();
            let pinyin = $('#pinyin').val();
            let phone = $('#phone').val();
            let email = $('#email').val();
            let book_date = $('#date').val();
            let wx_number = $('#wx_number').val();

            let isPhone = phone.match(/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/);
            let isEmail = email.match(/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/);
            if(name == ''){
                layui.use('layer', function(){
                    // var layer = layui.layer;
                    // layer.msg('请输入您的名字');

                    layer.ready(function(){
                        layer.msg('请输入您的名字', {icon:2});
                    });
                });

                return false;
            }
            if(isPhone == null){
                layui.use('layer', function(){
                    layer.ready(function(){
                        layer.msg('请输入正确的手机号', {icon:2});
                    });
                });
                return false;
            }

            if(isEmail == null){
                layui.use('layer', function(){
                    layer.ready(function(){
                        layer.msg('请输入正确的邮箱' , {icon:2});
                    });
                });
                return false;
            }

            $.ajax({
                url:'https://51bx.club/postBookInfo',
                type:'post',
                data:{name:name , pinyin:pinyin , phone:phone, email:email , book_date:book_date , wx_number:wx_number},
                success:function(){
                    layui.use('layer', function(){
                        layer.ready(function(){
                            layer.msg('感谢您的提交' , {icon: 1} , function(){
                                $('.back-mini').show();
                                $('.more-back-wall').show();

                                let redirectUrl = '/pages/index?target=customer';
                                wx.miniProgram.redirectTo({url: redirectUrl})
                            });
                        });
                    })
                }
            })
        })
    })
</script>
</html>